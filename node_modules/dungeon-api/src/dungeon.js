const axios = require('axios')

module.exports = async function fetchDungeon(botname, apikey, client) {

setInterval(() => {
  let ping = 0;
  let data;
  if(process.env.PING_CHANNEL) client.channels.cache.get(process.env.PING_CHANNEL).send(`Fetching ping`).then((msg => {
      ping = Date.now() - msg.createdTimestamp;
      try {
        msg.delete();
      } catch (e) {return;}
  }));
  
  setTimeout(async () => {
    await axios({
      method: 'POST',
      url: `https://developersdungeon.xyz/api/servers?code=${apikey}`,
      headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
      },
      data: {
        bot: botname,
        servers: client.guilds.cache.size,
        users: client.guilds.cache.reduce((a, b) => a + b.memberCount, 0).toLocaleString(),
        ping: ping * -1,
      },
    }).then((res) => {
      data = res.data;
    });
  }, 1000)
  }, 1.8e+6);
}